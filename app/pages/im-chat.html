<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>创始人</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />

		<link rel="stylesheet" href="../css/mui.min.css" />
		<link rel="stylesheet" href="../css/app.css" />
		<link rel="stylesheet" href="../css/message.css" />
		<script type="text/javascript" charset="UTF-8" src="../js/mui.min.js"></script>
		<script type="text/javascript" charset="UTF-8" src="../js/mui.indexedlist.js"></script>
		<style>
			footer {
				position: fixed;
				width: 100%;
				height: 50px;
				min-height: 50px;
				border-top: solid 1px #bbb;
				left: 0px;
				bottom: 0px;
				overflow: hidden;
				padding: 0px 50px 0 10px;
				background-color: #fafafa;
			}
			.footer-left {
				position: absolute;
				width: 50px;
				height: 50px;
				left: 0px;
				bottom: 0px;
				text-align: center;
				vertical-align: middle;
				line-height: 100%;
				padding: 12px 4px;
			}
			.footer-right {
				position: absolute;
				width: 50px;
				height: 50px;
				right: 0px;
				bottom: 0px;
				text-align: center;
				vertical-align: middle;
				line-height: 100%;
				padding: 12px 5px;
				display: inline-block;
			}
			.footer-center {
				height: 100%;
				padding: 5px 0px;
			}
			.footer-center [class*=input] {
				width: 100%;
				height: 100%;
				border-radius: 5px;
			}
			.footer-center .input-text {
				background: #fff;
				border: solid 1px #ddd;
				padding: 10px !important;
				font-size: 16px !important;
				line-height: 18px !important;
				font-family: verdana !important;
				overflow: hidden;
			}
			.mui-content {
				height: 100%;
				padding: 44px 0px 50px 0px;
				overflow: auto;
				background-color: #eaeaea;
			}
		</style>
		
		<script type="text/javascript">
			
			
			
			/**
			(function($) {
				document.addEventListener('mui.view.beforeshow', function(event) {
					event.detail.guid;
				});
			})(mui);
			**/
			
			
			
			var ws;
			mui.init();
			mui.plusReady(function() {
				if (!window.WebSocket) {
					window.WebSocket = window.MozWebSocket;
				}
				if (window.WebSocket) {
					ws = new WebSocket("ws://123.57.55.59:9099");
				}
				ws.onopen = function(event) {
					plus.nativeUI.toast("onopen : " + event.data);
					var presenceMsg = "{\"type\":3,\"mid\":5,\"passwd\":\"123456\"}";
					deliver(presenceMsg);
				};
				ws.onmessage = function(event) {
					plus.nativeUI.toast("onmessage : " + event.data);
				};
				/**
				ws.onerror = function(event) {
					plus.nativeUI.toast("onerror : " + event.data);
				};
				ws.onclose = function(event) {
					plus.nativeUI.toast("onclose : " + event.data);
				};
				**/
			});
	
	        mui('#send-msg').on('tap', function() {
	        		var body = mui('#msg-text').val();
	        		var message = "{\"type\":2,\"mid\":5,\"tid\":1,\"body\":\"" + body + "\",\"gmt_created\":1443251109367}";
				deliver(message);
			});
	
			function deliver(message) {
				if (!window.WebSocket) {
					return;
				}
				if (ws.readyState == WebSocket.OPEN) {
					ws.send(message);
				} else {
					plus.nativeUI.toast("网络无法连接");
				}
			}
			</script>
		
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 id="title" class="mui-title c-title">聊天</h1>
		</header>
		<div class="mui-content">
			<div class="message-history">
				<div class="message-reply">
					<div class="message-time">2014-2-21 9:32:57</div>
					<div class="message-info">
						<div class="user-info">
							<img class="user-avatar" src="../images/blank.jpg">
						</div>
						<div class="message-content-box">
							<div class="arrow"></div>
							<div class="message-content">这个东西不错呀！</div>
						</div>
					</div>
				</div>
				<div class="message-receive">
					<div class="message-time">2014-2-21 9:32:57</div>
					<div class="message-info">
						<div class="user-info">
							<img class="user-avatar" src="../images/user-photo.png">
						</div>
						<div class="message-content-box">
							<div class="arrow"></div>
							<div class="message-content">Good football</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<footer>
			<div class="footer-center">
				<textarea id='msg-text' type="text" class='input-text' placeholder="输入消息内容"></textarea>
			</div>
			<label class="footer-right">
				<span id="send-msg">发送</span>
			</label>
		</footer>
	</body>

</html>