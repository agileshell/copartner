<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>创始人</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />

		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/app.css" />
		<style>
		.home-menu {
			position: absolute;
			left: 0; top: 0; right: 0; bottom: 0;
		}
		.list1, .list2, .list3, .list4 {
			float: left;
			position: relative;
			border-radius: 5%;
		}
		.list1 {
			height: 27%;
		}
		.list2 {
			height: 26%;
		}
		.list3 {
			height: 26%;
		}
		.list4 {
			width: 32%;
			height: 16%;
		}
		.list1, .list2, .list3, .list4 {
			margin: 1% 0 0 1%;
		}
		.list1:last-child, .list2:last-child, .list3:last-child {
			margin: 1% 1% 0 1%;
		}
		.list1 img, .list2 img, .list3 img{
			padding: 5%;
			display:table-cell;
			vertical-align:middle;
			margin: auto;
			text-align: center;
		}
		.list1 span, .list2 span, .list3 span{
			font: 15px bold 'microsoft yahei';
			color: white;
		}
		.list4:after {
			content:attr(data-name);
			position: absolute;
			left: 0; right: 0; top: 0; bottom: 0;
			margin: auto;
			text-align: center;
			height: 20px;
			font: 15px bold 'microsoft yahei';
			color: white;
		}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="position: static;">
			<a class="mui-icon mui-icon-bars mui-pull-left"></a>
			<h1 id="title" class="mui-title c-title"><span class="c-logo">创始人</span></h1>
		</header>
		<div class="mui-content">
			<div id="slider" class="mui-slider" style="min-height: 213px;">
				<div class="mui-slider-group mui-slider-loop">
					<!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
					<div class="mui-slider-item">
						<a href="#">
							<img src="./tmp/2.jpg">
							<p class="mui-slider-title">与成功同行</p>
						</a>
					</div>
					<div class="mui-slider-item mui-slider-item-duplicate">
						<a href="#">
							<img src="./tmp/1.jpg">
							<p class="mui-slider-title">指点迷津，成就梦想</p>
						</a>
					</div>
					<div class="mui-slider-item">
						<a href="#">
							<img src="./tmp/2.jpg">
							<p class="mui-slider-title">与成功同行</p>
						</a>
					</div>
					<!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
					<div class="mui-slider-item mui-slider-item-duplicate">
						<a href="#">
							<img src="./tmp/1.jpg">
							<p class="mui-slider-title">与成功同行</p>
						</a>
					</div>
				</div>
				<div class="mui-slider-indicator mui-text-right">
					<div class="mui-indicator mui-active"></div>
					<div class="mui-indicator"></div>
				</div>
			</div>
			<div id="menus" class="home-menu">
				<div class="list1" id="rzrz_list"  data-url="pages/rzrz_list.html" align="center" data-name="融资融智" style="background-color: #94ce6d; width: 58.5%;">
					<img src="images/rzrz.png"/>
					<span>融资融智</span>
				</div>
				<div class="list1" id="tutor_list" data-url="pages/tutor_list.html" align="center" data-name="创业导师" style="background-color: #5cb6df; width: 38.5%;">
					<img src="images/ds.png"/>
					<span>创业导师</span>
				</div>
				<div class="list2" id="renmai"  data-url="pages/renmai.html" align="center" data-name="人脉" style="background-color: #f8666a; width: 38.5%;">
					<img src="images/rm.png"/>
					<span>人脉</span>
				</div>
				<div class="list2" id="contest" data-url="pages/contest.html" align="center" data-name="创业大赛" style="background-color: #f3ac2b; width: 58.5%;">
					<img src="images/cyds.png"/>
					<span>创业大赛</span>
				</div>
				<div class="list3" id="course_list" data-url="pages/course_list.html" align="center" data-name="充电站" style="background-color: #f57750; width: 58.5%;">
					<img src="images/cdz.png"/>
					<span>充电站</span>
				</div>
				<div class="list3" id="profile" data-url="pages/profile.html" align="center" data-name="我" style="background-color: #bf68a5; width: 38.5%;">
					<img src="images/me.png"/>
					<span>我</span>
				</div>
				<div class="list4" id="news_list" data-url="pages/news_list.html" data-name="最新动态" style="background-color: #8060f1"></div>
				<div class="list4" id="zhengce_list" data-url="pages/zhengce_list.html" data-name="政策解读" style="background-color: #8060f1"></div>
				<div class="list4" id="ziyuan_list" data-url="pages/ziyuan_list.html" data-name="公共资源" style="background-color: #8060f1"></div>
			</div>
		</div>
	</body>
	<script src="js/mui.min.js"></script>
	<script src="js/app.js"></script>
	<script>
			(function() {
				var menu = null, main = null, showMenu = false;
				mui.init({
					swipeBack:true,
					statusBarBackground: '#f7f7f7'
				});

				//slider
				var slider = mui("#slider");
				slider.slider({
					interval: 5000
				});

				mui.plusReady(function() {
					//仅支持竖屏显示
					plus.screen.lockOrientation("portrait-primary");
					main = plus.webview.currentWebview();
					main.addEventListener('maskClick', closeMenu);
					//处理侧滑导航，为了避免和子页面初始化等竞争资源，延迟加载侧滑页面
					setTimeout(function() {
						menu = mui.preload({
							id: 'slide_menu',
							url: 'slide_menu.html',
							styles: {
								left: 0,
								width: '70%',
								zindex: 100
							},
							show: {
								aniShow: 'none'
							}
						});
					}, 1000);
					var showGuide = plus.storage.getItem("lauchFlag");
					if (showGuide) {
						//关闭splash页面
						setTimeout(function() {
							plus.navigator.closeSplashscreen();
						}, 2000);
						//预加载
						preload();
					} else {
						//显示启动导航
						mui.openWindow({
							url: 'guide.html',
							id: 'guide',
							show: {
								aniShow: 'none'
							},
							waiting: {
								autoShow: false
							}
						});
						//延迟的原因：优先打开启动导航页面，避免资源争夺
						setTimeout(function() {
							//预加载
							preload();
						}, 200);
					}

					//push
					var setDeviceToken = plus.storage.getItem("setDeviceToken");
					if (!setDeviceToken) {
						var info = plus.push.getClientInfo();
						app.addDeviceToken(info.token, plus.os.name, function(){
							plus.storage.setItem("setDeviceToken", "true");
						});
					}
				});
				//初始化，并预加载webview
				function preload() {
					var topHeight = document.getElementById("slider").offsetHeight + 45;
					document.getElementById('menus').style.top = topHeight + 'px';
					//内置浏览器
					mui.preload({
						url: "browser.html",
						id: "browser_main",
						subpages: [{
							url: "",
							id: "browser",
							styles: {
								top: "0px",
								bottom: "44px"
							}
						}]
					});
					mui.preload({
						url: "login.html",
						id: "login"
					});
					mui.preload({
						url: "pages/news_list.html",
						id: "news_list"
					});
					mui.preload({
						url: "pages/zhengce_list.html",
						id: "zhengce_list"
					});
					mui.preload({
						url: "pages/ziyuan_list.html",
						id: "ziyuan_list"
					});
					mui.preload({
						url: "pages/rzrz_list.html",
						id: "rzrz_list"
					});
					mui.preload({
						url: "pages/renmai.html",
						id: "renmai"
					});
					mui.preload({
						url: "pages/course_list.html",
						id: "course_list"
					});
					mui.preload({
						url: "pages/tutor_list.html",
						id: "tutor_list"
					});
					mui.preload({
						url: "pages/profile.html",
						id: "profile"
					});
				};
				var loginPage = null,
					profilePage = null,
					renmaiPage = null,
					rzrzPage = null;
				mui('#menus').on('tap', 'div', function() {
					var id = this.getAttribute('id');
					if ('profile' == id || 'renmai' == id) {
						var state = app.getState();
						//检查 "登录状态"
						if (state.userId) {
							if ('profile' == id) {
								if (!profilePage) {
									profilePage = plus.webview.getWebviewById('profile');
								}
								mui.fire(profilePage, 'mui.view.beforeshow', {
									needReflush: false
								});
							} else if ('renmai' == id) {
								if (!renmaiPage) {
									renmaiPage = plus.webview.getWebviewById('renmai');
								}
								mui.fire(renmaiPage, 'mui.view.beforeshow', {});
							}
						} else {
							if (!loginPage) {
								loginPage = plus.webview.getWebviewById('login');
							}
							loginPage.show();
							return;
						}
					} else if ('rzrz_list' == id) {
						if (!rzrzPage) {
							rzrzPage = plus.webview.getWebviewById('rzrz_list');
						}
						mui.fire(rzrzPage, 'mui.view.beforeshow', {});
					}
					var aniShow = "pop-in";
					mui.openWindow({
						id: id,
						url: this.getAttribute('data-url'),
						show: {
							aniShow: aniShow
						},
						waiting: {
							autoShow: false
						}
					});
				});

				var isInTransition = false;
				/**
				 * 显示侧滑菜单
				 */
				function openMenu() {
					if (isInTransition) {
						return;
					}
					if (!showMenu) {
						mui.fire(menu, 'mui.view.beforeshow', {});

						//侧滑菜单处于隐藏状态，则立即显示出来；
						isInTransition = true;
						menu.setStyle({
							mask: 'rgba(0,0,0,0)'
						}); //menu设置透明遮罩防止点击
						menu.show('none', 0, function() {
							//主窗体开始侧滑并显示遮罩
							main.setStyle({
								mask: 'rgba(0,0,0,0.4)',
								left: '70%',
								transition: {
									duration: 150
								}
							});
							mui.later(function() {
								isInTransition = false;
								menu.setStyle({
									mask: "none"
								}); //移除menu的mask
							}, 160);
							showMenu = true;
						});
					}
				};
				/**
				 * 关闭菜单
				 */
				function closeMenu() {
					if (isInTransition) {
						return;
					}
					if (showMenu) {
						//关闭遮罩；
						//主窗体开始侧滑；
						isInTransition = true;
						main.setStyle({
							mask: 'none',
							left: '0',
							transition: {
								duration: 200
							}
						});
						showMenu = false;
						//等动画结束后，隐藏菜单webview，节省资源；
						mui.later(function() {
							isInTransition = false;
							menu.hide();
						}, 300);
					}
				};
				 //点击左上角侧滑图标，打开侧滑菜单；
				document.querySelector('.mui-icon-bars').addEventListener('tap', function(e) {
					if (showMenu) {
						closeMenu();
					} else {
						openMenu();
					}
				});
				//主界面向右滑动，若菜单未显示，则显示菜单；否则不做任何操作
				window.addEventListener("swiperight", openMenu);
				 //主界面向左滑动，若菜单已显示，则关闭菜单；否则，不做任何操作；
				window.addEventListener("swipeleft", closeMenu);
				 //侧滑菜单触发关闭菜单命令
				window.addEventListener("menu:close", closeMenu);
				window.addEventListener("menu:open", openMenu);
				 //重写mui.menu方法，Android版本menu按键按下可自动打开、关闭侧滑菜单；
				mui.menu = function() {
						if (showMenu) {
							closeMenu();
						} else {
							openMenu();
						}
				}

				//退出应用
				var backButtonPress = 0;
				mui.back = function(event) {
					backButtonPress++;
					if (backButtonPress > 1) {
						app.setState({});
						plus.runtime.quit();
					} else {
						plus.nativeUI.toast('再按一次退出应用');
					}
					setTimeout(function() {
						backButtonPress = 0;
					}, 1000);
					return false;
				};
			})();
		</script>

</html>