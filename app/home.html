<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>创始人</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />

		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/app.css" />
		<style>
			.mui-grid-view.mui-grid-9 {
				background-color: #efeff4;
			}
			.mui-table-view:before,
			.mui-table-view:after {
				background-color: #efeff4;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="position: static;">
			<a class="mui-icon mui-icon-bars mui-pull-left"></a>
			<h1 id="title" class="mui-title c-title"><span class="c-logo">创始人</span></h1>
		</header>
		<div class="mui-content">
			<ul id="list" class="mui-table-view mui-grid-view mui-grid-9">
				<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
					<a id="news_list" href="pages/news_list.html">
						<span class="home-grid c-news-icon"></span>
						<div class="mui-media-body">最新动态</div>
					</a>
				</li>
				<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
					<a id="zhengce_list" href="pages/zhengce_list.html">
						<span class="home-grid c-zhengce-icon"></span>
						<div class="mui-media-body">政策解读</div>
					</a>
				</li>
				<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
					<a id="ziyuan_list" href="pages/ziyuan_list.html">
						<span class="home-grid c-resource-icon"></span>
						<div class="mui-media-body">公共资源</div>
					</a>
				</li>
				<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
					<a id="rzrz_list" href="pages/rzrz_list.html">
						<span class="home-grid c-rzrz-icon"></span>
						<div class="mui-media-body">融资融智</div>
					</a>
				</li>
				<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
					<a id="renmai" href="pages/renmai.html">
						<span class="home-grid c-renmai-icon"></span>
						<div class="mui-media-body">人脉</div>
					</a>
				</li>
				<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
					<a id="forum" href="pages/forum.html">
						<span class="home-grid c-community-icon"></span>
						<div class="mui-media-body">创业大赛</div>
					</a>
				</li>
				<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
					<a id="tutor_list" href="pages/tutor_list.html">
						<span class="home-grid c-tutor-icon"></span>
						<div class="mui-media-body">创业导师</div>
					</a>
				</li>
				<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
					<a id="course_list" href="pages/course_list.html">
						<span class="home-grid c-charging-icon"></span>
						<div class="mui-media-body">充电站</div>
					</a>
				</li>
				<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
					<a id="profile" href="pages/profile.html">
						<span class="home-grid c-my-icon"></span>
						<div class="mui-media-body">我</div>
					</a>
				</li>
			</ul>
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/app.js"></script>
		<script>
			(function() {
				var menu = null,
					main = null;
				var showMenu = false;
				mui.init({
					statusBarBackground: '#f7f7f7'
				});
				mui.plusReady(function() {
					//仅支持竖屏显示
					plus.screen.lockOrientation("portrait-primary");
					main = plus.webview.currentWebview();
					main.addEventListener('maskClick', closeMenu);
					//处理侧滑导航，为了避免和子页面初始化等竞争资源，延迟加载侧滑页面
					setTimeout(function() {
						menu = mui.preload({
							id: 'slide_menu',
							url: 'slide_menu.html',
							styles: {
								left: 0,
								width: '70%',
								zindex: 100
							},
							show: {
								aniShow: 'none'
							}
						});
					}, 200);
					var showGuide = plus.storage.getItem("lauchFlag");
					if (showGuide) {
						//关闭splash页面
						setTimeout(function() {
							plus.navigator.closeSplashscreen();
						}, 3000);
						//预加载
						preload();
					} else {
						//显示启动导航
						mui.openWindow({
							url: 'guide.html',
							id: 'guide',
							show: {
								aniShow: 'none'
							},
							waiting: {
								autoShow: false
							}
						});
						//延迟的原因：优先打开启动导航页面，避免资源争夺
						setTimeout(function() {
							//预加载
							preload();
						}, 200);
					}
				});
				//初始化，并预加载webview		
				function preload() {
					//内置浏览器
					mui.preload({
						url: "browser.html",
						id: "browser_main",
						subpages: [{
							url: "",
							id: "browser",
							styles: {
								top: "0px",
								bottom: "44px"
							}
						}]
					});
					mui.preload({
						url: "login.html",
						id: "login"
					});
					mui.preload({
						url: "pages/news_list.html",
						id: "news_list"
					});
					mui.preload({
						url: "pages/zhengce_list.html",
						id: "zhengce_list"
					});
					mui.preload({
						url: "pages/ziyuan_list.html",
						id: "ziyuan_list"
					});
					mui.preload({
						url: "pages/rzrz_list.html",
						id: "rzrz_list"
					});
					mui.preload({
						url: "pages/renmai.html",
						id: "renmai"
					});
					mui.preload({
						url: "pages/course_list.html",
						id: "course_list"
					});
					mui.preload({
						url: "pages/tutor_list.html",
						id: "tutor_list"
					});
					mui.preload({
						url: "pages/profile.html",
						id: "profile"
					});
				};
				var loginPage = null,
					profilePage = null,
					renmaiPage = null;
				mui('#list').on('tap', 'a', function() {
					if ('#' == this.getAttribute('href')) {
						plus.nativeUI.toast('TODO');
						return;
					}
					var id = this.getAttribute('id');
					if ('profile' == id || 'renmai' == id) {
						var state = app.getState();
						//检查 "登录状态"
						if (state.userId) {
							if ('profile' == id) {
								if (!profilePage) {
									profilePage = plus.webview.getWebviewById('profile');
								}
								mui.fire(profilePage, 'mui.view.beforeshow', {
									needReflush: false
								});
							} else if ('renmai' == id) {
								if (!renmaiPage) {
									renmaiPage = plus.webview.getWebviewById('renmai');
								}
								mui.fire(renmaiPage, 'mui.view.beforeshow', {});
							}
						} else {
							if (!loginPage) {
								loginPage = plus.webview.getWebviewById('login');
							}
							loginPage.show();
							return;
						}
					}
					var aniShow = "pop-in";
					mui.openWindow({
						id: id,
						url: this.href,
						show: {
							aniShow: aniShow
						},
						waiting: {
							autoShow: false
						}
					});
				});

				var isInTransition = false;
				/**
				 * 显示侧滑菜单
				 */
				function openMenu() {
					if (isInTransition) {
						return;
					}
					if (!showMenu) {
						mui.fire(menu, 'mui.view.beforeshow', {});

						//侧滑菜单处于隐藏状态，则立即显示出来；
						isInTransition = true;
						menu.setStyle({
							mask: 'rgba(0,0,0,0)'
						}); //menu设置透明遮罩防止点击
						menu.show('none', 0, function() {
							//主窗体开始侧滑并显示遮罩
							main.setStyle({
								mask: 'rgba(0,0,0,0.4)',
								left: '70%',
								transition: {
									duration: 150
								}
							});
							mui.later(function() {
								isInTransition = false;
								menu.setStyle({
									mask: "none"
								}); //移除menu的mask
							}, 160);
							showMenu = true;
						});
					}
				};
				/**
				 * 关闭菜单
				 */
				function closeMenu() {
					if (isInTransition) {
						return;
					}
					if (showMenu) {
						//关闭遮罩；
						//主窗体开始侧滑；
						isInTransition = true;
						main.setStyle({
							mask: 'none',
							left: '0',
							transition: {
								duration: 200
							}
						});
						showMenu = false;
						//等动画结束后，隐藏菜单webview，节省资源；
						mui.later(function() {
							isInTransition = false;
							menu.hide();
						}, 300);
					}
				};
				 //点击左上角侧滑图标，打开侧滑菜单；
				document.querySelector('.mui-icon-bars').addEventListener('tap', function(e) {
					if (showMenu) {
						closeMenu();
					} else {
						openMenu();
					}
				});
				//主界面向右滑动，若菜单未显示，则显示菜单；否则不做任何操作
				window.addEventListener("swiperight", openMenu);
				 //主界面向左滑动，若菜单已显示，则关闭菜单；否则，不做任何操作；
				window.addEventListener("swipeleft", closeMenu);
				 //侧滑菜单触发关闭菜单命令
				window.addEventListener("menu:close", closeMenu);
				window.addEventListener("menu:open", openMenu);
				 //重写mui.menu方法，Android版本menu按键按下可自动打开、关闭侧滑菜单；
				mui.menu = function() {
						if (showMenu) {
							closeMenu();
						} else {
							openMenu();
						}
				}

				//退出应用
				var backButtonPress = 0;
				mui.back = function(event) {
					backButtonPress++;
					if (backButtonPress > 1) {
						app.setState({});
						plus.runtime.quit();
					} else {
						plus.nativeUI.toast('再按一次退出应用');
					}
					setTimeout(function() {
						backButtonPress = 0;
					}, 1000);
					return false;
				};
			})();
		</script>
	</body>

</html>